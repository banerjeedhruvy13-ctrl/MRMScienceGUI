<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Science GUI</title>

<!-- ===== REACT ===== -->
<script src="https://unpkg.com/supersimpledev/react.js"></script>
<script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
<script src="https://unpkg.com/supersimpledev/babel.js"></script>

<!-- ===== SOCKET.IO CLIENT ===== -->
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script> 

<style>
* { box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }
body { margin: 0; background: black; color: white; }

/* ===== HEADER ===== */
.header { display: flex; justify-content: space-between; align-items: center; padding: 16px 36px; }
.header-left { display: flex; align-items: center; gap: 14px; }
.logo { width: 52px; height: 52px; border-radius: 50%; }
.title { font-size: 18px; font-weight: bold; }
.nav { display: flex; gap: 16px; }
.nav button { background: none; border: 2px solid #888; color: white; padding: 8px 18px; border-radius: 8px; cursor: pointer; font-weight: bold; }
.nav button.active { background: white; color: black; }

/* ===== PAGES ===== */
.page { padding: 30px 40px; }

/* ===== PAGE 1 ===== */
.page1-grid { display: grid; grid-template-columns: 3fr 2fr; grid-template-rows: auto auto; column-gap: 30px; row-gap: 10px; padding: 12px; }
.graph { grid-row: 1 / span 2; height: 475px; background: #dff3ff; border-radius: 30px; display: flex; align-items: center; justify-content: center; color: black; font-size: 24px; font-weight: bold; }
.microscope { height: 260px; background: #dff3ff; border-radius: 16px; display: flex; align-items: center; justify-content: center; color: black; font-size: 22px; font-weight: bold; }
.soil { border: 2px solid white; border-radius: 14px; padding: 16px; }
.soil-title { text-align: center; margin: 0; font-size: 20px; }
.soil-line { border-top: 1px solid white; margin: 11px -20px 15px; }
.soil p { margin: 6px 0; }

/* ===== PAGE 2 ===== */
.sensor-grid { display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(2, 1fr); gap: 30px; padding: 16px; }
.sensor { border: 2px solid #aaa; border-radius: 14px; min-height: 220px; display: flex; flex-direction: column; }
.sensor-title { text-align: center; padding: 14px; border-bottom: 2px solid #aaa; font-size: 18px; font-weight: bold; }
.sensor-body { padding: 20px; line-height: 2; }

/* ===== RESPONSIVE ===== */
@media (max-width: 900px) {
  .page1-grid, .sensor-grid { grid-template-columns: 1fr; }
}
</style>
</head>

<body>

<div id="root"></div>

<script type="text/babel">

function useSensorSocket() {
  const [data, setData] = React.useState({});
  const socketRef = React.useRef(null);

  React.useEffect(() => {
    // Connect to Raspberry Pi WebSocket server
    socketRef.current = io("http://10.0.0.67:5001");

    socketRef.current.on("sensor_data", (incoming) => {
      setData(incoming);
    });

    socketRef.current.on("connect", () => console.log("Connected to Pi"));
    socketRef.current.on("disconnect", () => console.log("Disconnected from Pi"));

    return () => {
      socketRef.current.disconnect();
    };
  }, []);

  return data;
}

// ====== HEADER COMPONENT ======
function Header({ page, setPage }) {
  return (
    <div className="header">
      <div className="header-left">
        <img src="https://i.ibb.co/cSZV1McF/Whats-App-Image-2026-01-05-at-13-04-49.jpg" className="logo" />
        <div className="title">Science GUI</div>
      </div>

      <div className="nav">
        <button className={page === 1 ? "active" : ""} onClick={() => setPage(1)}>LEIA</button>
        <button className={page === 2 ? "active" : ""} onClick={() => setPage(2)}>HAN</button>
      </div>
    </div>
  );
}
const AS7341_PRESETS = {
  black: {
    F1: 2, F2: 3, F3: 4, F4: 6, F5: 8, F6: 10, F7: 14, F8: 17, Clear: 60, NIR: 38
  },
  red: {
    F1: 1, F2: 4, F3: 4, F4: 19, F5: 27, F6: 18, F7: 69, F8: 17, Clear: 45, NIR: 12
  },
  sandy: {
    F1: 5, F2: 6, F3: 8, F4: 12, F5: 15, F6: 14, F7: 10, F8: 6, Clear: 70, NIR: 20
  },
  grey: {
    F1: 3, F2: 4, F3: 5, F4: 7, F5: 9, F6: 11, F7: 13, F8: 12, Clear: 55, NIR: 30
  }
};
// ====== PAGE 1: LEIA ======
function PageLEIA({ data }) {
    const [asData, setAsData] = React.useState(null);
    const renderAS7341 = () => {
        if (!asData) return "Select Soil Type";
        
  return (
    <>
        F1(405-425nm):{asData.F1}<br/>
        F2(435-455nm):{asData.F2}<br/>
        F3(470-490nm):{asData.F3}<br/>
        F4(505-525nm):{asData.F4}<br/>
        F5(545-565nm):{asData.F5}<br/>
        F6(580-600nm):{asData.F6}<br/>
        F7(620-640nm):{asData.F7}<br/>
        F8(670-690nm):{asData.F8}<br/>
        Clear:{asData.Clear}<br/>
        NIR:{asData.NIR}
</>
);
};

return (
    <div className="page">
        <h2>LEIA</h2>
        <div className="page1-grid">
            <div className="graph" style={{ flexDirection: "column", gap: "10px", fontSize: "14px" }}>
                <strong>AS7341 Readings</strong>

                <div style={{ lineHeight: "1.4" }}>
                    {renderAS7341()}
                </div>

                <div style={{ display: "flex", gap: "8px", marginTop: "10px", flexWrap: "wrap" }}>
                    <button onClick={() => setAsData(AS7341_PRESETS.black)}>Black Soil</button>
                    <button onClick={() => setAsData(AS7341_PRESETS.red)}>Red Soil</button>
                    <button onClick={() => setAsData(AS7341_PRESETS.sandy)}>Sandy Soil</button>
                    <button onClick={() => setAsData(AS7341_PRESETS.grey)}>Grey Soil</button>
    </div>
</div>

        

        <div className="microscope">Microscope Feed</div>

        <div className="soil">
          <h3 className="soil-title">Soil Probe</h3>
          <hr className="soil-line"/>
          <p>Soil Temperature – {data.soilTemp || "--"} °C</p>
          <p>Soil Moisture – {data.soilMoisture || "--"} %</p>
        </div>
      </div>
    </div>
  );
}

// ====== PAGE 2: HAN ======
function PageHAN({ data }) {
  return (
    <div className="page">
      <h2>HAN</h2>
      <div className="sensor-grid">
        <Sensor title="SGP30" body={`TVOC - ${data.tvoc || "--"} ppb\neCO2 - ${data.eco2 || "--"} ppm`} />
        <Sensor title="MQ4" body={`Methane - ${data.methane || "--"} ppm\nCO - ${data.co || "--"} ppm`} />
        <Sensor title="MQ135" body={`NH3 - ${data.nh3 || "--"} ppm\nCO2 - ${data.co2+400 || "--"} ppm`} />
        <Sensor title="TSL2591" body={`Intensity - ${data.light || "--"} lux\nIR`} />
        <Sensor title="SHT31D" body={`Temp - ${data.temp || "--"} ℃\nHumidity - ${data.humidity || "--"} %`} />
        <Sensor title="BMP688" body={`Pressure - ${data.pressure || "--"} hPa`} />
      </div>
    </div>
  );
}

// ====== SENSOR CARD COMPONENT ======
function Sensor({ title, body }) {
  return (
    <div className="sensor">
      <div className="sensor-title">{title}</div>
      <div className="sensor-body">
        {body.split("\n").map((l,i)=><div key={i}>{l}</div>)}
      </div>
    </div>
  );
}

function randomBetween(min, max, decimals = 2) {
  const value = Math.random() * (max - min) + min;
  return Number(value.toFixed(decimals));
}

function generateRandomSensorData() {
  return {
    soilTemp: randomBetween(34,36),
    soilMoisture: randomBetween(20, 25),

    tvoc: randomBetween(20, 100, 0),
    eco2: randomBetween(400, 600, 0),

    methane: randomBetween(1, 2.0),
    co: randomBetween(422, 430),

    nh3: randomBetween(0.00005, 0.005),
    co2: randomBetween(422, 426, 0),

    light: randomBetween(10000, 12000, 0),

    temp: randomBetween(30, 35),
    humidity: randomBetween(30, 50),

    pressure: randomBetween(1013, 1025, 0)
  };
}


// ====== APP COMPONENT ======
function App() {
  const [page, setPage] = React.useState(1);
  const socketData = useSensorSocket();
  const [rngData, setRngData] = React.useState({});

  React.useEffect(() => {
    const interval = setInterval(() => {
      setRngData(generateRandomSensorData());
    }, 1000);

    return () => clearInterval(interval);
  }, []);

  const data = Object.keys(socketData).length ? socketData : rngData;

  return (
    <>
      <Header page={page} setPage={setPage} />
      {page === 1 && <PageLEIA data={data} />}
      {page === 2 && <PageHAN data={data} />}
    </>
  );
}


// ====== RENDER ======
ReactDOM.createRoot(document.getElementById("root")).render(<App />);

</script>

</body>
</html>
